---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# NCBNAqua

NCBNAqua provides functions for downloading and working with water data for the NCBN protocols from the NPS Aquarius database.This package utilizes the National Park Service [fetchaquarius](https://github.com/nationalparkservice/imd-fetchaquarius) package for the API connection to the database.

## Installation

You can install the development version of NCBNAqua from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("laura-feher/NCBNAqua")
```

## Set & Store API credentials

The first time you use the package, you'll need to set and store credentials for the Aquarius API using the [keyring](https://keyring.r-lib.org/) package. Running the function keyring::key_set() will open a dialog box that will prompt you for a password. Note that this only needs to be done once. Contact laura_feher at nps.gov for more info.

```{r}
library(keyring)

# keyring::key_set("aquarius", "aqreadonly")
```

## Establish a Connection to Aquarius

```{r}
# establish connection to Aquarius
fetchaquarius::connectToAquarius("aqreadonly")
```

## Download water data for a specific NCBN park and protocol

The function get_wl_data() downloads the data from Aquarius and formats it into a single data frame.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(NCBNAqua)

# Download water level data from the SET sites at ASIS
asis_set_wl <- get_wl_data(park_code = "ASIS", protocol = "SET")

head(asis_set_wl)
```

```{r}
# Download seagrass water data (all parameters) from CACO
caco_seagrass_wl <- get_wl_data(park_code = "CACO", protocol = "ENE_Seagrass")

head(caco_seagrass_wl)
```

```{r}
# Download ENE water quality data (all parameters) from GEWA and filter to just Chlorophyll 
gewa_wq_wl <- get_wl_data(park_code = "GEWA", protocol = "ENE_WQ") %>%
  filter(Label %in% c("Chl", "Chlorophyll Âµg/L"))

head(gewa_wq_wl)
```

## Working with Water Level data

The remaining functions in the package are meant to be used only with water level data referenced to NAVD88 from the SET sites.

```{r}
tidal_datums(wl_data = asis_set_wl)
```
